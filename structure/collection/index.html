
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://datashades.github.io/ckanext-collection/structure/collection/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../domain/">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Collection - ckanext-collection</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#collection" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ckanext-collection" class="md-header__button md-logo" aria-label="ckanext-collection" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ckanext-collection
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Collection
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/DataShades/ckanext-collection" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ckanext-collection" class="md-nav__button md-logo" aria-label="ckanext-collection" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    ckanext-collection
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/DataShades/ckanext-collection" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interfaces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Structure
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Structure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Collection
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Collection
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replacing-the-service" class="md-nav__link">
    <span class="md-ellipsis">
      Replacing the service
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../domain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abstract service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../columns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Columns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serializer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../filters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filters
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../examples/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accessing data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replacing-the-service" class="md-nav__link">
    <span class="md-ellipsis">
      Replacing the service
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="collection">Collection</h1>
<h2 id="overview">Overview</h2>
<p>Collection works as a proxy between user and collection's services. It hides
internal complexity and simplifies access to data.</p>
<p>The very base collection contains no data. It can be initialized using
<code>Collection</code> constructor.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="go">[]</span>
</code></pre></div>
<p>Constructor of collection accepts two positional arguments:</p>
<ul>
<li><code>name</code>: string containing letters, numbers, underscores and hyphens</li>
<li><code>params</code>: dictionary that can be used by services. There are no rules that
  define, how exactly params are used and whether or not they are used at
  all. Everything depends on services. For example, pager <em>usually</em> checks
  <code>page</code> and <code>rows_per_page</code> inside <code>params</code>. Data service often uses fields
  from <code>params</code> to filter data.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>params</code> depend on collection name. If the name is empty, params are used
without changes. If name is not empty, params are filtered and
transformed. First, any member of params that is not prefixed with collection
name and colon is removed. Then, the prefix is removed.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;xxx:b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;yyy:c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span> <span class="c1"># (1)!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span><span class="o">.</span><span class="n">params</span>
<span class="go">{&quot;a&quot;: 1, &quot;xxx:b&quot;: 2, &quot;yyy:c&quot;: 3}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;xxx:b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;yyy:c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span> <span class="c1"># (2)!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span><span class="o">.</span><span class="n">params</span>
<span class="go">{&quot;b&quot;: 2}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="s2">&quot;yyy&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;xxx:b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;yyy:c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span> <span class="c1"># (3)!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span><span class="o">.</span><span class="n">params</span>
<span class="go">{&quot;c&quot;: 3}</span>
</code></pre></div>
<ol>
<li>All parameter are kept because collection has no name.</li>
<li>Only <code>xxx:b</code> is kept and its name transformed to just <code>b</code>, because
   collection has name <code>xxx</code>.</li>
<li>Only <code>yyy:c</code> is kept and its name transformed to just <code>c</code>, because
   collection has name <code>yyy</code>.</li>
</ol>
</div>
<details class="tip">
<summary>Why <code>params</code> are transformed?</summary>
<p>As long as collection is initialized manually and don't have a name, you don't
need to think about <code>params</code> transformation.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;xxx:b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;yyy:c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span><span class="o">.</span><span class="n">params</span>
<span class="go">{&quot;a&quot;: 1, &quot;xxx:b&quot;: 2, &quot;yyy:c&quot;: 3}</span>
</code></pre></div>
<p>Transformation becomes important, whn you initialize registered <em>named</em>
collection via <code>get_collection</code></p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">get_collection</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="s2">&quot;my-collection&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;my-collection:b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span><span class="o">.</span><span class="n">params</span>
<span class="go">{&quot;b&quot;: 2}</span>
</code></pre></div>
<p>This design decision was made to simplify rendering conllections on webpages.</p>
<p>Imagine the page that renders <code>users</code> and <code>packages</code> collection. These
collections are rendered as tables with pagination and view code looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">ckan.plugins.toolkit</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">ckan.logic</span> <span class="kn">import</span> <span class="n">parse_params</span>

<span class="nd">@route</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">users_and_packages</span><span class="p">():</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">parse_params</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

    <span class="n">users</span> <span class="o">=</span> <span class="n">get_collection</span><span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">packages</span> <span class="o">=</span> <span class="n">get_collection</span><span class="p">(</span><span class="s2">&quot;packages&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tk</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="n">users</span><span class="p">,</span>
        <span class="s2">&quot;packages&quot;</span><span class="p">:</span> <span class="n">packages</span><span class="p">,</span>
    <span class="p">})</span>
</code></pre></div>
<p>Because <code>params</code> uses collection name as prefix, it's possible to paginate
collections separately. Query string <code>?users:page=2&amp;packages:page=8</code> parsed
into <code>params</code> dictionary on the first line of view. This dictionary contains
both page values with prefixes. When <code>users</code> and <code>packages</code> collections
initialized, they pick only relevant values from <code>params</code>, so <code>users</code> takes
<code>page=2</code> and <code>packages</code> takes <code>page=8</code>.</p>
<p>In this way, <code>params</code> flow naturally from user into collection. When you are
initializing collections in code, most likely you'll interact with collection
classes instead of <code>get_collection</code>, so you can leave collection name empty and
keep all <code>params</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">col</span> <span class="o">=</span> <span class="n">MyCollection</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="o">...</span><span class="p">})</span>
</code></pre></div>
<p>And when you must use <code>get_collection</code> with named collection, but want to pass
all <code>params</code> into collection, you can easily add prefixes yoursef:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my-collection&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">get_collection</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span><span class="o">.</span><span class="n">params</span>
<span class="go">{&quot;a&quot;: 1, &quot;b&quot;: 2}</span>
</code></pre></div>
<p>And to make it even simpler, <code>get_collection</code> accepts <code>prefix_params</code> as 3rd
positional argument. When this flag is enabled, prefixes are added
automatically, so you can achieve the same effect as in snippet above using
short version:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">get_collection</span><span class="p">(</span><span class="s2">&quot;my-collection&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span><span class="o">.</span><span class="n">params</span>
<span class="go">{&quot;a&quot;: 1, &quot;b&quot;: 2}</span>
</code></pre></div>
</details>
<h2 id="initialization">Initialization</h2>
<p>When a collection is created, it initializes services using service factories
and service settings. <code>data</code> service is initialized using
<code>Collection.DataFactory</code> class and <code>data_settings</code>, <code>serializer</code> is initialized
using <code>Collection.SerializerService</code> and <code>serializer_settings</code>, etc.</p>
<p>This logic creates a workflow for defining new collections. Create a subclass
of base Collection and override <code>*Factory</code> of this new class.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCollection</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">):</span>
    <span class="n">DataFactory</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">StaticData</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">MyCollection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">)</span>
<span class="go">True</span>
</code></pre></div>
</div>
<p>Now you only need to find a suitable class for the service and job is done.</p>
<p>But as soon as you choose the class, you'll notice, that majority of service
factories must be configured before using. For example, the <code>StaticData</code> used
in the example above produces records using iterable source. And this iterable
must be configured, or you'll get just empty list from <code>StaticData</code>:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">MyCollection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="go">[]</span>
</code></pre></div>
<p>Configuration for services can be specified using keyword-only arguments of the
collection's constructor. Pass <code>&lt;SERVICE&gt;_settings</code> dictionary to collection
and this dictionary will be used as service settings. <code>data_settings={...}</code> is
passed to data service, <code>pager_settings={...}</code> is passed to pager service,
etc.</p>
<p>Iterable with items is controlled by <code>data</code> parameter of <code>StatiData</code>. And it
means you need to pass <code>data_settings={"data": [1, 2, 3]}</code> to collection
constructor, if you want to use <code>[1, 2, 3]</code> as a data collection.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">MyCollection</span><span class="p">(</span><span class="n">data_settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</code></pre></div>
</div>
<p>Instead of specifying <code>data</code> every time, you can create a derived class from
<code>StaticData</code> and replace the default value of <code>data</code>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyData</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">MyCollection</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">):</span>
    <span class="n">DataFactory</span> <span class="o">=</span> <span class="n">MyData</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">MyCollection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</code></pre></div>
</div>
<p>New classes are created quite often with ckanext-collection. And every existing
service has a shortcut for creating its derivable with customized attributes.</p>
<p>Whenever you need to extend parent service and set <code>attr</code> to <code>value</code> in the
child class, use <code>with_attributes</code> classmethod of the parent service.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="n">MyData</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="o">.</span><span class="n">with_attributes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">MyCollection</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">):</span>
    <span class="n">DataFactory</span> <span class="o">=</span> <span class="n">MyData</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">MyCollection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</code></pre></div>
</div>
<p>And, in the same way you can pass settings for services, you can also specify
factories when collection is initialized. Every <code>&lt;SERVICE&gt;_factory</code> paramterer
of the collection's constructor overrides corresponding factory of the
collection: <code>data_factory=StaticData</code> sets <code>DataFactory = StaticData</code>,
<code>serializer_factory=CsvSerializer</code> sets <code>SerializerFactory = CsvSerializer</code>,
etc.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Instead of creating a new classes from previous examples, you could use the
following code:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">data_factory</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">data_settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]},</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div>
<p>Or even:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">data_factory</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="o">.</span><span class="n">with_attributes</span><span class="p">(</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">),</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div>
<p>This form is convenient when you experimenting with collections or creating
them dynamically. But more often you'll create a separate class for collection
and services. Using separate classes is more readable and flexible, as you keep
all the derived classes and can combine/reuse them in future.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>*_factory</code> accepts <strong>a class</strong> that can be used to initialize the service. You can
use <code>data.StaticData</code>, because it's a class. Or you can use
<code>data.StaticData.with_attributes(data=[1, 2, 3])</code>, because this method creates
a new class.</p>
<p>But you cannot use <code>data_factory=data.StaticData()</code> with parenthesis, because
in this way you create <strong>an instance</strong> of the service and this instance cannot
be used to initialize another instance.</p>
<p>Remember: factory is a class; service is an object of this class.</p>
</div>
<h2 id="usage">Usage</h2>
<p>Collections are not very impressive. You literally can create the collection
and then you can iterate over a single page of collection results. But this
must be exactly what you are doing most of the time. In a well defined
collection, you don't need to access any services, apart from serializer.</p>
<p>Let's use collection of all users from DB.</p>
<div class="admonition abstract">
<p class="admonition-title">Definition of collection</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">ckan</span> <span class="kn">import</span> <span class="n">model</span>
<span class="kn">from</span> <span class="nn">ckanext.collection.shared</span> <span class="kn">import</span> <span class="n">collection</span><span class="p">,</span> <span class="n">data</span>

<span class="k">class</span> <span class="nc">Users</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">):</span>
    <span class="n">DataFactory</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">with_attributes</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">User</span><span class="p">,</span>
        <span class="n">is_scalar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
</div>
<p>Initialize this collection without arguments to work with 1st-10th users <code class="highlight"><span class="n">users</span> <span class="o">=</span> <span class="n">Users</span><span class="p">()</span></code>.</p>
<p>You can use direct access to data service to get users from 11th: <code class="highlight"><span class="n">users</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span></code>. But you can also initialize the collection for the second
page: <code class="highlight"><span class="n">users</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span><span class="n">pager_settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span></code>.</p>
<p>If you know that you'll process more than 10 users at once, it's still possible
to avoid direct access to data. Just set <code>rows_per_page</code> option of the pager:
<code class="highlight"><span class="n">users</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span><span class="n">pager_settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rows_per_page&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">})</span></code></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>ModelData</code> supports search by filterable columns. For example, if you want to
search users by <code>sysadmin</code> flag, configure columns service and add <code>sysadmin</code>
to the <code>Columns.filterable</code>:</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">sysadmins</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">{</span><span class="s2">&quot;sysadmin&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">columns_factory</span><span class="o">=</span><span class="n">columns</span><span class="o">.</span><span class="n">Columns</span><span class="o">.</span><span class="n">with_attributes</span><span class="p">(</span><span class="n">filterable</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sysadmin&quot;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">all</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">sysadmin</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">sysadmins</span><span class="p">)</span>
<span class="go">True</span>
</code></pre></div>
<p>Obviously, you can just create plain collection of users and pick sysadmins
manually, iterating over <code>users.data</code>. And it would be absolutely normal
solution, that works with any collection.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">sysadmins</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">user</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">Users</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">sysadmin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">]</span>
</code></pre></div>
<p>But some services have more efficient ways to work with data, other than naive
iteration. In case of <code>ModelData</code>, specifying <code>Columns.filterable</code> and using
params of collection to filter the data produces optimized SQL query that
fetches only required rows from DB.</p>
<p>Always check documentation of the collection and its services and there is a
chance that you'll find more efficient solution of your problem.</p>
</div>
<h2 id="replacing-the-service">Replacing the service</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This functionality is experimental and can change in future. Use it only if you
see no other ways to achieve the result.</p>
</div>
<p>It's possible to replace collection services after collection
initialized. There are two ways to do it: by creating a new instance of the
service and by expropriation service from the different collection.</p>
<p>Creating a new service is staightforward. Service's constructor accepts
collection as first positional argument and unlimited number of keyword-only
arguments which are collected as service's settings.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_service</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_service</span> <span class="ow">is</span> <span class="n">col</span><span class="o">.</span><span class="n">data</span>
<span class="go">True</span>
</code></pre></div>
<p>The above example approximately the same as the following code</p>
<div class="highlight"><pre><span></span><code><span class="n">col</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span>
    <span class="n">data_factory</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">,</span>
    <span class="n">data_settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]},</span>
<span class="p">)</span>
</code></pre></div>
</div>
<p>When a new service is created, old service instance is discarded and the new
one is attached to the collection. As you can see in the example, there is no
need to assign the service into collection's <code>data</code> attribute. We just
initialize the service and it automatically got into the right place.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never use discarded service. It still has references to its parent collection,
but collection itself does not recognize the discarded service anymore. This
one-way reference often produce strange behavior.</p>
</div>
<p>Reusing service from the existing collection is also simple. Just call
<code>replace_service</code> of the new collection, that will take the service, and pass
into it service that must be attached to collection.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="n">data_factory</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dest</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dest</span><span class="o">.</span><span class="n">replace_service</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">)</span>
<span class="go">True</span>
</code></pre></div>
</div>
<p><code>replace_service</code> also detaches old service and attaches the new one to
collection. And, on top of this, the new service <em>is detached from its original
collection</em>. It makes original collection unusable, unless you give it a new
service instance instead.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Collection that lost its service because it was transfered to another
collection, must not be used anymore. Just as with detached services, old
collection still contains reference to its detached service, but service
becomes the part of different collection and has no back reference to old
collection. Using collection with such kind of one-way reference to service
ofter produces strange behavior.</p>
<p>If you want to use collection that lost its service, initialize a new service
that will replace the old instance:</p>
<div class="highlight"><pre><span></span><code><span class="n">src</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="n">data_factory</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">)</span>
<span class="n">dest</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">Collection</span><span class="p">()</span>
<span class="n">dest</span><span class="o">.</span><span class="n">replace_service</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># right now `src` cannot be used</span>

<span class="n">data</span><span class="o">.</span><span class="n">StaticData</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

<span class="c1"># now `src` got a new data service and it can be used again</span>
</code></pre></div>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Structure of the collection">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Structure of the collection
              </div>
            </div>
          </a>
        
        
          
          <a href="../domain/" class="md-footer__link md-footer__link--next" aria-label="Next: Abstract service">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Abstract service
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.footer", "navigation.indexes", "navigation.top", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>